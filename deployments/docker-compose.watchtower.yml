# ServerEye Bot Watchtower Configuration
# Auto-updates bot containers when new images are available in GHCR

version: '3.8'

services:
  watchtower:
    image: containrrr/watchtower:latest
    container_name: ServerEyeBot-Watchtower
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./config.json:/config.json:ro  # GHCR authentication config
    environment:
      # Check for updates every 60 seconds
      - WATCHTOWER_POLL_INTERVAL=60
      # Only update containers with this label
      - WATCHTOWER_SCOPE=servereye
      # Clean up old images after update
      - WATCHTOWER_CLEANUP=true
      # Remove stopped containers
      - WATCHTOWER_REMOVE_VOLUMES=true
      # Rollback on failure
      - WATCHTOWER_ROLLBACK=true
      # Timeout for container operations
      - WATCHTOWER_TIMEOUT=30s
      # Don't restart containers if they were stopped before
      - WATCHTOWER_REVIVE_STOPPED=false
      # Log level
      - WATCHTOWER_LOG_LEVEL=info
      # Send notifications (webhook)
      - WATCHTOWER_NOTIFICATION_URL=${WEBHOOK_URL:-}
      - WATCHTOWER_NOTIFICATION_TEMPLATE_LEVEL=
      - WATCHTOWER_NOTIFICATION_TEMPLATE_TITLE=ServerEye Bot Update
      - WATCHTOWER_NOTIFICATION_TEMPLATE_BODY=Container {{.Container}} updated to {{.Image}}
    labels:
      - "com.centurylinklabs.watchtower.enable=false"  # Don't update watchtower itself
    networks:
      - servereye-network

networks:
  servereye-network:
    external: true
